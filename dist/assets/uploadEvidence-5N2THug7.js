import{K as I,r,d as M,D as G,j as e,Q as P,N as Y,T as p,E as f,O as z,U as W,V as H,W as K,X as N,Y as u,S as i,B as g,f as Q,G as y,F as v,H as X}from"./index-vuQvxRF2.js";import{F as q}from"./form-provider-GIR-cDeR.js";import{U as b}from"./upload-avatar-bnfNulnn.js";import"./format-number-11ZuXRMA.js";import"./transition-Uc7vb3zK.js";function J(){const U=I(),[m,F]=r.useState(""),[_,C]=r.useState(""),[a,l]=r.useState([]),D=()=>y.success("Your Document Uploaded"),h=()=>y.error("Failed to Upload"),S=r.useMemo(()=>({doc_type:""}),[]),x=M({defaultValues:S}),{handleSubmit:w,control:R}=x,k=sessionStorage.getItem("vendor");r.useEffect(()=>{C(k||"")},[]);const c=w(async s=>{const t=a.map((n,d)=>{if(n){const o=new FormData;return o.append("doc_type",s.doc_type),o.append("vendor_code",_),o.append("file",n),o}return null}).filter(n=>n!==null);try{(await Promise.all(t.map(o=>G.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/upload_document",o,{headers:{"Content-Type":"multipart/form-data"}})))).every(o=>o.data.status==="201")?D():h()}catch(n){console.error("Error submitting form:",n),h()}}),E=[{label:"Milling Unit Photo",key:"milling_unit_photo"},{label:"Milling Unit Video",key:"milling_unit_video"}],T=r.useCallback(s=>t=>{const n=t[0];n&&l(d=>{const o=[...d];return o[s]=Object.assign(n,{preview:URL.createObjectURL(n)}),o})},[]),L=s=>e.jsx(v,{children:e.jsx(i,{spacing:3,sx:{p:3},children:e.jsxs(i,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",children:"Upload Your Document"}),e.jsx(b,{file:a[s],onDrop:T(s),onDelete:()=>l(t=>{const n=[...t];return n[s]=null,n})})]})})},s),O=r.useCallback(s=>{l([...s.map(t=>Object.assign(t,{preview:URL.createObjectURL(t)}))])},[a]),V=s=>{const t=a.filter(n=>n!==s);l(t)},j=()=>{l([])},A=s=>e.jsx(v,{children:e.jsx(i,{spacing:3,sx:{p:3},children:e.jsxs(i,{spacing:1.5,children:[e.jsx(p,{variant:"subtitle2",children:"Upload Your Document"}),e.jsx(b,{multiple:!0,thumbnail:!0,files:a,onDrop:O,onRemove:V,onRemoveAll:j,onUpload:c})]})})},s);function B(){switch(m){case"milling_unit_photo":return e.jsx(e.Fragment,{children:Array.from({length:5}).map((s,t)=>e.jsx(u,{item:!0,xs:12,sm:6,md:4,children:L(t)},t))});case"milling_unit_video":return Array.from({length:1}).map((s,t)=>e.jsx(u,{item:!0,xs:12,sm:6,md:4,children:A(t)},t));default:return null}}return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsxs(Y,{maxWidth:U.themeStretch?!1:"xl",children:[e.jsx(p,{variant:"h4",children:"Evidence"}),e.jsx(f,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)"},sx:{mt:"40px"},children:e.jsx(z,{name:"doc_type",control:R,render:({field:s})=>e.jsxs(W,{fullWidth:!0,children:[e.jsx(H,{children:"Document Type"}),e.jsx(K,{...s,label:"Document Type",onChange:t=>{s.onChange(t),l([]),F(t.target.value)},children:E.map(t=>e.jsx(N,{value:t.key,children:t.label},t.key))})]})})}),e.jsx(f,{sx:{mt:5,width:1,borderRadius:2},children:e.jsxs(q,{methods:x,onSubmit:c,children:[e.jsx(u,{container:!0,spacing:5,children:B()}),m=="milling_unit_photo"&&e.jsxs(i,{direction:"row",justifyContent:"flex-end",spacing:1.5,children:[e.jsx(g,{color:"inherit",variant:"outlined",size:"small",onClick:j,children:"Remove All"}),e.jsx(g,{size:"small",variant:"contained",onClick:c,startIcon:e.jsx(Q,{icon:"eva:cloud-upload-fill"}),children:"Save"})]})]})})]})]})}function ne(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx("title",{children:" Dashboard: Upload Evidence"})}),e.jsx(J,{})]})}export{ne as default};
